# Отчёт по экспериментам с моделями рекомендательных систем

## 1. Введение

Кратко опишите общую задачу:

- Какие датасеты (MovieLens, FilmTrust) мы используем.
- Какие модели (PMF, BPR, SoRec, SVD, NMF, FM).
- Цель экспериментов: получить рекомендации и оценить качество (Precision@K, Recall@K, NDCG@K).

---

## 2. Подготовка окружения

- **Версия Python**: укажите версию (3.8 или 3.9 и т.д.).
- **Установка необходимых библиотек**:

```bash
pip install cornac
pip install pandas
pip install numpy
...
```

- **Структура проекта**:

```bash
my_project/
├─ filmtrust/
│   ├─ ratings.txt
│   ├─ trust.txt
├─ ml-20m/
│   ├─ ratings.csv
│   ├─ movies.csv
│   └─ ...
├─ recommender.py
├─ pipline.py
├─ experiment.log
└─ REPORT.md  <-- (файл с отчётом)
```

*(Вставьте свой вариант, где у вас лежат скрипты и датасеты.)*

---

## 3. Описание входных данных

### 3.1. MovieLens

- **Путь к датасету**: `ml-20m/ratings.csv` (и `movies.csv`).
- **Структура**: поля `userId, movieId, rating, timestamp`.
- Общее число строк (пример: ~20 миллионов).
- Пример записи:

```
userId=1, movieId=31, rating=2.5, timestamp=1260759144
```

### 3.2. FilmTrust

- **Путь к датасету**: `filmtrust/ratings.txt`, `filmtrust/trust.txt`.
- **`ratings.txt`** содержит `user item rating`.
- **`trust.txt`** содержит `user friend`.
- Пример записи в `ratings.txt`:

```
2 1 4.0
2 3 2.5
```

а в `trust.txt`:
```
2 1
2 3
```

*(При необходимости добавьте дополнительную информацию об источниках датасетов.)*

---

## 4. Логика работы `pipeline.py` (или `run_pipeline`)

1. **Чтение датасета**  
   Код в `pipeline.py` читает файлы (CSV, TXT), формирует список `(user, item, rating, [timestamp])`.
2. **Инициализация Recommender**  
   - Передаём модель (например, `'PMF'` или `'SoRec'`),  
   - Параметры: `user_subset_ratio`, `use_full_dataset`, `min_interactions`, `seed`, `k`/`k2`, `max_iter` и т.д.  
3. **Разбиение на train/test** внутри `Recommender`:
   - Даунсэмплинг по пользователям (берём только некоторую часть, чтобы ускорить обучение).
   - Последнее взаимодействие пользователя идёт в test (если `use_full_dataset=False`).
4. **Обучение (`fit`)**:
   - Запускается обучение выбранной модели (PMF, BPR, SoRec и т.п.) на `train_data`.
   - Если есть `test_data`, по завершении вызывает `evaluate()`, логируя `Precision@10`, `Recall@10`, `NDCG@10`.
5. **Генерация рекомендаций (`recommend`)**:
   - Для каждого пользователя из `train`, формируем top-N список.
   - Сохраняем в CSV (например, `movielens_pmf.csv`).

---

## 5. Запуск экспериментов

Ниже пример запуска (обратите внимание на фрагмент с `experiments`):

```python
if __name__ == "__main__":
    experiments = [
        {
            'dataset_type': 'movielens',
            'model_name': 'PMF',
            'output_csv': 'ml_pmf.csv',
            'user_subset_ratio': 1.0,
            'use_full_dataset': False,
            'min_interactions': 2,
            'seed': 42,
            'k': 10,
            'max_iter': 20
        },
        ...
    ]

    for exp in experiments:
        logging.info("=== Запуск эксперимента: %s + %s ===",
                     exp['dataset_type'], exp['model_name'])
        run_pipeline(**exp)
        logging.info("=== Эксперимент завершён ===")
```

### 5.1 Пример логов

```text
2025-03-21 12:48:17,870 - INFO - Recommender: выбрано 13849 пользователей, train=1996752, test=13849
2025-03-21 12:49:12,569 - INFO - PMF Test => P@10=0.0001, R@10=0.0012, NDCG@10=0.0005
2025-03-21 12:49:22,189 - INFO - Saved recommendations => ml_pmf.csv
...
2025-03-21 13:01:47,239 - INFO - SOREC Test => P@10=0.0147, R@10=0.1469, NDCG@10=0.0796
```

*(При желании вставьте **скриншот** из консоли / IDE.)*

---

## 6. Результаты

Соберите результаты метрик в таблицу (пример):

| Модель  | Датасет     | Subset Ratio | P@10    | R@10    | NDCG@10  |
|---------|-------------|--------------|---------|---------|----------|
| PMF     | MovieLens   | 1.0          | 0.0001  | 0.0012  | 0.0005   |
| BPR     | MovieLens   | 0.5          | –       | –       | –        |
| SoRec   | FilmTrust   | 1.0          | 0.0147  | 0.1469  | 0.0796   |
| SVD     | FilmTrust   | 0.5          | 0.0000  | 0.0000  | 0.0000   |
| NMF     | MovieLens   | 1.0          | 0.0000  | 0.0001  | 0.0001   |

*(Подставьте свои актуальные цифры.)*

**Примечания**:
- Видно, что `SoRec` на FilmTrust имеет более высокие метрики, чем SVD (который дал 0.0).
- На MovieLens (большой датасет) метрики могут быть крайне малыми.

---

## 7. Обсуждение и выводы

1. **Низкие метрики** на MovieLens:
   - Объясните, почему может быть сложно достичь высоких Recall/Precision на большом и разреженном датасете.
   - Возможно, нужно более тонкая настройка параметров (`k`, `max_iter`, `learning_rate`).
2. **Социальная модель SoRec** на FilmTrust:
   - Показывает чуть лучший результат (Recall@10=0.1469) благодаря учёту дружеских связей.
3. **Время обучения / Память**:
   - Упомяните, что FM может "падать" из-за std::bad_alloc при недостатке RAM.
   - BPR может обучаться дольше, особенно на больших данных.
4. **Возможные улучшения**:
   - Увеличение числа эпох (`max_iter`).
   - Настройка параметров (learning rate, регуляризация).
   - Испытать **другие** современные модели (Neural Networks, LightGCN, MultiVAE, и т.д.).
   - Учитывать контент (описания фильмов) – но это уже модель CTR.

---

## 8. Список литературы / ссылки (опционально)

- [Cornac Documentation](https://cornac.readthedocs.io/)
- [MovieLens](https://grouplens.org/datasets/movielens/)
- [FilmTrust original dataset link (Epinions/FilmTrust)](https://github.com/srijithrajagopal/trust_datasets)

*(Можете добавить, если есть другие релевантные источники.)*

---

## 9. Приложения

- Полный текст логов (`experiment.log`) или необходимые выдержки.
- Исходный код `pipeline.py` и `recommender.py` (если не включили в основной раздел).
- Дополнительные графики (если строили зависимость метрик от числа факторов `k` и т.д.).


> Таким образом, мы протестировали несколько коллаборативных моделей на двух датасетах. Несмотря на низкие метрики на MovieLens, результаты являются воспроизводимыми и подтверждают, что отбор параметров модели и учёт дополнительной информации (соц. граф FilmTrust) может повышать качество рекомендаций.

